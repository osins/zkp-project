# 电路审查清单

## 📋 使用说明

在提交电路到 `circuits/production/` 目录前，必须完成此清单中的所有检查项。

**审查流程:**
1. 开发者自检（完成所有检查项）
2. 提交 Pull Request
3. 至少 2 名审查员独立审查
4. 所有审查员通过后方可合并

---

## ✅ 第一部分: 代码完整性检查

### 1.1 文档声明

- [ ] 电路文件顶部包含完整的文档块
- [ ] 明确标注电路用途
- [ ] 明确标注状态（生产/示例/废弃）
- [ ] 列出所有输入信号及其类型（private/public）
- [ ] 列出所有输出信号及其类型（private/public）
- [ ] 说明约束逻辑和数量
- [ ] 列出安全假设
- [ ] 包含使用场景和限制
- [ ] 标注作者和审查人
- [ ] 包含版本号和日期

### 1.2 信号声明

- [ ] 所有输入信号已明确声明
- [ ] 所有输出信号已明确声明
- [ ] 所有中间信号已明确声明
- [ ] 信号命名清晰、有意义
- [ ] 无未使用的信号声明

### 1.3 约束完整性

- [ ] 所有输出信号都有约束
- [ ] 所有中间信号都有约束
- [ ] 无硬编码常量（除非有充分理由并注释）
- [ ] 无魔法数字
- [ ] 约束逻辑清晰、正确
- [ ] 无可绕过的约束

### 1.4 安全性检查

- [ ] 使用安全的密码学原语（Poseidon、MiMC 等）
- [ ] 避免使用不安全的操作（平方哈希、简单加法哈希等）
- [ ] 输入范围已验证（如需要）
- [ ] 溢出风险已考虑
- [ ] 边界条件已处理

---

## ✅ 第二部分: 测试覆盖检查

### 2.1 单元测试

- [ ] 存在测试文件（`tests/test_[circuit_name].js`）
- [ ] 测试覆盖率 >= 90%
- [ ] 包含正常情况测试
- [ ] 包含边界情况测试
  - [ ] 零值输入
  - [ ] 最大值输入
  - [ ] 最小值输入
- [ ] 包含无效输入测试
  - [ ] 负数（如不允许）
  - [ ] 超出范围值
  - [ ] 非法格式

### 2.2 集成测试

- [ ] 与 snarkjs 工具链集成测试通过
- [ ] Witness 生成测试通过
- [ ] 证明生成测试通过
- [ ] 证明验证测试通过
- [ ] Solidity calldata 导出测试通过

### 2.3 性能测试

- [ ] 记录了约束数量
- [ ] 记录了证明生成时间
- [ ] 记录了验证时间
- [ ] 记录了 Gas 消耗（链上验证）

---

## ✅ 第三部分: 文档完整性检查

### 3.1 代码文档

- [ ] 关键逻辑有注释
- [ ] 复杂算法有说明
- [ ] 引用外部资源（如论文）已标注

### 3.2 使用文档

- [ ] 提供使用示例
- [ ] 说明输入格式
- [ ] 说明输出格式
- [ ] 列出常见错误和解决方案

### 3.3 安全文档

- [ ] 列出所有安全假设
- [ ] 说明信任模型
- [ ] 标注已知限制
- [ ] 说明不适用场景

---

## ✅ 第四部分: 工具链检查

### 4.1 编译检查

- [ ] `circom` 编译无错误
- [ ] `circom` 编译无警告
- [ ] 生成的 R1CS 文件正确
- [ ] 生成的 WASM 文件可用

### 4.2 构建脚本

- [ ] 构建脚本存在且可执行
- [ ] 构建脚本文档完整
- [ ] 构建输出符合预期

### 4.3 CI/CD 检查

- [ ] CI 检查通过
- [ ] Linter 检查通过
- [ ] 自动化测试通过

---

## ✅ 第五部分: 代码审查检查

### 5.1 代码质量

- [ ] 代码结构清晰
- [ ] 命名规范一致
- [ ] 无冗余代码
- [ ] 无复制粘贴代码（如有，已提取为模板）

### 5.2 最佳实践

- [ ] 遵循 Circom 最佳实践
- [ ] 使用 circomlib 标准模板（如适用）
- [ ] 避免重新发明轮子
- [ ] 考虑了性能优化

### 5.3 审查流程

- [ ] 至少 2 名审查员
- [ ] 审查员独立审查
- [ ] 所有审查意见已解决
- [ ] 审查记录已归档

---

## ✅ 第六部分: 安全审查检查

### 6.1 威胁建模

- [ ] 识别了潜在攻击向量
- [ ] 评估了攻击成本
- [ ] 制定了缓解措施

### 6.2 常见漏洞检查

- [ ] 无约束绕过漏洞
- [ ] 无整数溢出漏洞
- [ ] 无哈希碰撞风险
- [ ] 无时序攻击风险
- [ ] 无侧信道泄露

### 6.3 密码学审查

- [ ] 使用的密码学原语是标准的
- [ ] 密码学参数选择合理
- [ ] 安全级别满足需求（如 128-bit 安全性）

---

## ✅ 第七部分: 生产就绪检查

### 7.1 部署准备

- [ ] 生成了最终的 zkey
- [ ] 导出了 verification key
- [ ] 生成了 Solidity verifier
- [ ] Verifier 合约已测试

### 7.2 监控和维护

- [ ] 制定了监控计划
- [ ] 制定了应急响应计划
- [ ] 制定了升级计划

### 7.3 用户支持

- [ ] 提供了用户文档
- [ ] 提供了 FAQ
- [ ] 建立了支持渠道

---

## 📝 审查签名

### 开发者自检

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**确认:** 我已完成所有检查项，确认电路符合生产标准。

---

### 审查员 1

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**审查意见:**
- [ ] 通过
- [ ] 需要修改后重新审查

**备注:** _______________________________________________________________

---

### 审查员 2

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**审查意见:**
- [ ] 通过
- [ ] 需要修改后重新审查

**备注:** _______________________________________________________________

---

### 安全审查员（如需要）

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**审查意见:**
- [ ] 通过
- [ ] 需要修改后重新审查

**备注:** _______________________________________________________________

---

## 📎 附件

- [ ] 测试报告
- [ ] 性能测试结果
- [ ] 安全审查报告
- [ ] 其他相关文档

---

**文档版本:** 1.0.0  
**最后更新:** 2025-11-08  
**维护者:** ZKP Project Team
