# Halo2 电路审查清单

## 📋 使用说明

在提交 Halo2 电路到生产目录前，必须完成此清单中的所有检查项。

**审查流程**:
1. 开发者自检（完成所有检查项）
2. 提交 Pull Request
3. 至少 2 名审查员独立审查
4. 所有审查员通过后方可合并

---

## ✅ 第一部分: 代码完整性检查

### 1.1 文档注释

- [ ] 电路结构体包含完整的文档注释
- [ ] 明确标注电路用途和状态
- [ ] 列出所有输入/输出及其类型（Private/Public）
- [ ] 说明约束逻辑和数量
- [ ] 列出安全假设
- [ ] 包含使用示例
- [ ] 标注作者和审查人
- [ ] 包含版本号和日期

### 1.2 Config 结构

- [ ] 所有列（Advice/Instance）已明确声明
- [ ] Selector 已声明
- [ ] 结构命名清晰、有意义
- [ ] 实现了 `Clone` 和 `Debug` trait

### 1.3 configure 方法

- [ ] 所有 Advice 列启用 `enable_equality`
- [ ] 所有 Instance 列启用 `enable_equality`
- [ ] 所有 gate 有完整的约束逻辑
- [ ] 无空的 gate（`vec![]`）
- [ ] Selector query 正确使用
- [ ] 约束逻辑清晰、正确

### 1.4 synthesize 方法

- [ ] 使用 `Value::known()` 或 `Value::unknown()` 处理 witness
- [ ] Selector 正确启用
- [ ] 所有 advice 值已分配
- [ ] 所有公共输出通过 `constrain_instance` 约束
- [ ] 返回 `Result<(), Error>`
- [ ] 无 `unwrap()` 或有充分理由并注释

### 1.5 without_witnesses 方法

- [ ] 返回无 witness 的电路实例
- [ ] 所有 `Option<Fp>` 字段设为 `None`
- [ ] 不包含任何私密值

---

## ✅ 第二部分: 测试覆盖检查

### 2.1 单元测试

- [ ] 存在测试文件（`tests/test_[circuit_name].rs`）
- [ ] 测试覆盖率 >= 90%
- [ ] `without_witnesses` 测试通过
- [ ] 正常情况测试通过
- [ ] 边界情况测试
  - [ ] 零值输入
  - [ ] 最大值输入
  - [ ] 特殊值（如 1, -1）
- [ ] 无效输入测试
  - [ ] 错误的公共输入
  - [ ] 违反约束的输入

### 2.2 MockProver 测试

- [ ] 使用 `MockProver::run()` 测试
- [ ] `verify()` 在有效输入时返回 `Ok(())`
- [ ] `verify()` 在无效输入时返回 `Err(...)`
- [ ] 测试不同的 `k` 值

### 2.3 集成测试

- [ ] 与 WASM 接口集成测试
- [ ] 证明生成测试
- [ ] 证明验证测试
- [ ] 序列化/反序列化测试

---

## ✅ 第三部分: 安全检查

### 3.1 约束完整性

- [ ] 所有输出都有约束
- [ ] 所有中间计算都有约束
- [ ] 无可绕过的约束路径
- [ ] Selector 正确启用，无遗漏

### 3.2 Value 处理

- [ ] 使用 `Value::known()` 处理已知值
- [ ] 使用 `Value::unknown()` 处理未知值
- [ ] 无直接 `unwrap()` 导致 panic
- [ ] 默认值使用有充分理由并注释

### 3.3 Equality 约束

- [ ] 所有需要相等性的列已启用 `enable_equality`
- [ ] `constrain_instance` 正确使用
- [ ] Cell 引用正确

### 3.4 数值安全

- [ ] 考虑了字段溢出
- [ ] 考虑了零值边界
- [ ] 考虑了负数（如适用）

---

## ✅ 第四部分: 性能检查

### 4.1 电路大小

- [ ] 记录了约束数量
- [ ] 记录了推荐的 `k` 值
- [ ] 电路大小合理（不过度浪费）

### 4.2 证明性能

- [ ] 记录了证明生成时间
- [ ] 记录了验证时间
- [ ] 性能符合预期

---

## ✅ 第五部分: 代码质量

### 5.1 代码风格

- [ ] 遵循 Rust 命名规范
- [ ] 代码格式化（`cargo fmt`）
- [ ] 无 Clippy 警告（`cargo clippy`）
- [ ] 注释清晰、适量

### 5.2 错误处理

- [ ] 使用 `Result` 返回错误
- [ ] 错误信息清晰
- [ ] 无 `panic!` 或有充分理由

### 5.3 依赖管理

- [ ] 仅使用必要的依赖
- [ ] 依赖版本明确
- [ ] 无未使用的依赖

---

## ✅ 第六部分: 文档检查

### 6.1 代码文档

- [ ] 所有公共 API 有文档注释
- [ ] 复杂逻辑有内联注释
- [ ] 示例代码可运行

### 6.2 README

- [ ] 电路功能说明
- [ ] 使用示例
- [ ] 依赖说明
- [ ] 构建指令

---

## ✅ 第七部分: CI/CD 检查

### 7.1 自动化测试

- [ ] 所有测试通过（`cargo test`）
- [ ] 无测试被忽略（除非有理由）
- [ ] WASM 构建成功（`wasm-pack build`）

### 7.2 代码质量检查

- [ ] 格式检查通过（`cargo fmt --check`）
- [ ] Lint 检查通过（`cargo clippy`）
- [ ] 无编译警告

---

## 📝 审查签名

### 开发者自检

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**确认:** 我已完成所有检查项，确认电路符合生产标准。

---

### 审查员 1

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**审查意见:**
- [ ] 通过
- [ ] 需要修改后重新审查

**主要检查项:**
- [ ] 代码完整性
- [ ] 约束正确性
- [ ] 测试覆盖

**备注:** _______________________________________________________________

---

### 审查员 2

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**审查意见:**
- [ ] 通过
- [ ] 需要修改后重新审查

**主要检查项:**
- [ ] 安全性
- [ ] 性能
- [ ] 文档质量

**备注:** _______________________________________________________________

---

### 安全审查员（如需要）

**姓名:** ________________  
**日期:** ________________  
**签名:** ________________

**审查意见:**
- [ ] 通过
- [ ] 需要修改后重新审查

**安全检查:**
- [ ] 约束完整性
- [ ] Value 处理安全性
- [ ] 无信息泄露

**备注:** _______________________________________________________________

---

## 📎 附件

- [ ] 测试报告
- [ ] 性能测试结果
- [ ] 安全审查报告
- [ ] MockProver 输出
- [ ] 其他相关文档

---

**文档版本**: 1.0.0  
**最后更新**: 2025-11-08  
**维护者**: ZKP Project Team
